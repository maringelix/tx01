# kube-prometheus-stack MICRO Configuration
# PLAN 3: Optimized for 7x t3.micro nodes (28 pods capacity)
# Target: Use only 4 pods total (Prometheus, Grafana, KSM, Operator)

# Prometheus Server - Ultra Minimal
prometheus:
  prometheusSpec:
    retention: 2d  # Reduced from 3d
    retentionSize: 1GB  # Reduced from 1500MB
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          resources:
            requests:
              storage: 1Gi  # Reduced from 2Gi
    resources:
      requests:
        memory: 128Mi  # Reduced from 256Mi
        cpu: 50m  # Reduced from 100m
      limits:
        memory: 256Mi  # Reduced from 512Mi
        cpu: 100m  # Reduced from 200m
    # Scrape less frequently to reduce load
    scrapeInterval: 60s  # Default is 30s
    evaluationInterval: 60s

# Grafana - Minimal
grafana:
  enabled: true
  # Disable persistence to save pods
  persistence:
    enabled: false  # Changed from true - use ephemeral storage
  service:
    type: ClusterIP  # Use port-forward to access (no LoadBalancer overhead)
  resources:
    requests:
      memory: 64Mi  # Reduced from 100Mi
      cpu: 25m  # Reduced from 50m
    limits:
      memory: 128Mi  # Reduced from 200Mi
      cpu: 50m  # Reduced from 100m
  # Disable plugins to save memory
  plugins: []

# Kube State Metrics - Ultra Minimal
kubeStateMetrics:
  enabled: true
  resources:
    requests:
      memory: 32Mi  # Reduced from 64Mi
      cpu: 5m  # Reduced from 10m
    limits:
      memory: 64Mi  # Reduced from 128Mi
      cpu: 25m  # Reduced from 50m

# Disable components for MICRO stack
alertmanager:
  enabled: false

prometheus-node-exporter:
  enabled: false  # Too resource intensive for t3.micro

# Prometheus Operator - Minimal
prometheusOperator:
  admissionWebhooks:
    enabled: false  # Disable webhooks to save resources
  resources:
    requests:
      memory: 64Mi  # Reduced from 128Mi
      cpu: 25m  # Reduced from 50m
    limits:
      memory: 128Mi  # Reduced from 256Mi
      cpu: 50m  # Reduced from 100m

# Global settings for resource efficiency
defaultRules:
  create: false  # Disable default alerting rules to save memory

# Limit number of shards
prometheus:
  prometheusSpec:
    replicas: 1  # Single replica only
    shards: 1  # No sharding
